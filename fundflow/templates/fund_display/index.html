{% load l10n %}
{% load i18n %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Swiss Tax Information</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  {% csrf_token %}
</head>
<body>
  <nav class="navbar">
    <div class="navbar-container">
      <a class="navbar-brand" href="{% url 'fund_display:home' %}">FundFlow</a>
      <form method="post" action="{% url 'fund_display:set_language' %}" class="language-selector">
        {% csrf_token %}
        <select name="language" onchange="this.form.submit()">
          {% get_current_language as LANGUAGE_CODE %}
          {% for lang_code, lang_name in LANGUAGES %}
            <option value="{{ lang_code }}" {% if lang_code == LANGUAGE_CODE %}selected{% endif %}>
              {{ lang_name }}
            </option>
          {% endfor %}
        </select>
      </form>
    </div>
  </nav>
  <div class="container">
    <header>
      <h1>Swiss Tax Distribution Calculator</h1>
      <p>{% trans 'Find out how your tax money is distributed across different sectors' %}</p>
    </header>

    <section class="tax-form">
      <form id="taxForm" method="POST" action="{% url 'fund_display:home' %}">
        {% csrf_token %}
        <div class="form-group">
          <label for="taxAmount">{% trans  'How much taxes did you pay this year? (CHF)' %}</label>
          <input type="number" id="taxAmount" name="taxAmount" min="0" required>
        </div>

        <div class="form-group">
          <label for="canton">{% trans 'In which canton do you live?' %}</label>
          <select id="canton" name="canton" required>
            <option value="" disabled selected>{% trans 'Select your canton' %}</option>
            {% for id, name in cantons.items %}
              <option value="{{ id.lower }}">{{ name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group checkbox">
          <input type="checkbox" id="detailedView" name="detailedView">
          <label for="detailedView">{% trans 'Show detailed breakdown' %}</label>
        </div>

        <button type="submit" class="btn-submit">{% trans 'Calculate Distribution' %}</button>
      </form>
    </section>

    {% if entries is not None %}
    <section class="results" id="results">
      <h2>{% trans 'Your Tax Distribution' %}</h2>
      <div class="summary-container">
        <div class="total-tax">
          <h3>{% trans 'Total Tax Paid' %}</h3>
          <span id="totalTaxValue">{% trans 'CHF' %} {{ total }}</span>
        </div>
        <div class="canton-info">
          <h3>{% trans 'Canton' %}</h3>
          <span id="cantonName">{{ canton }}</span>
        </div>
      </div>
      
      <div class="distribution-container" id="distribution-container">
          <!-- Distribution items will be dynamically generated here -->
      </div>
      
      <div class="detailed-view" id="detailedResults">
        <h3>{% trans 'Breakdown' %}</h3>
        <table>
          <thead>
            <tr>
              <th>{% trans 'Category' %}</th>
              <th>{% trans 'Percentage' %}</th>
              <th>{% trans 'Amount (CHF)' %}</th>
            </tr>
          </thead>
            <tbody id="detailTable">
            {% for entry in entries %}
              <tr>
                <td class="category-name">{{ entry.name }}</td>
                <td>
                  <div class="progress-bar">
                    {% localize off %}
                    <div class="progress" style="width: {{ entry.percentage }}%"></div>
                    {% endlocalize %}
                  </div>
                </td>
                <td class="amount">CHF {{ entry.amount }}</td>
              </tr>
            {% endfor %}
            </tbody>
        </table>
      </div>
    </section>
    {% endif %}
  </div>

    <footer>
      <p>&copy; {% now "Y" %} Yann Gaspoz. All rights reserved.</p>
    </footer>
</body>
</html>
